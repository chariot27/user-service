# ‚öôÔ∏è Etapa 1: Build da aplica√ß√£o
FROM gradle:8.5-jdk17 AS builder

WORKDIR /app

# Copia arquivos do projeto
COPY . .

# Executa o build (gera o .jar)
RUN gradle build -x test

# üê≥ Etapa 2: Imagem final com JDK 17 minimalista
FROM eclipse-temurin:17-jdk-alpine

# Define diret√≥rio de trabalho
WORKDIR /app

# Copia o .jar do build
COPY --from=builder /app/build/libs/*.jar app.jar

# Define vari√°veis de ambiente padr√£o (override no Docker Run ou Render)
ENV SERVER_PORT=8081

# Exp√µe a porta configurada (Render usa isso)
EXPOSE ${SERVER_PORT}

# Comando para iniciar a aplica√ß√£o
ENTRYPOINT ["java", "-jar", "app.jar"]
